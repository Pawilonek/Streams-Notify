var streams=null;var flashMessages={TYPE_NOTIFICATION:"notification",TYPE_SUCCESS:"success",TYPE_WARNING:"warning",TYPE_ERROR:"error",TYPE_INFO:"info",slideDuration:300,container:"#flashMessages",getType:function(type){switch(type){case this.TYPE_NOTIFICATION:case this.TYPE_SUCCESS:case this.TYPE_WARNING:case this.TYPE_ERROR:case this.TYPE_INFO:return type;break;default:return this.TYPE_NOTIFICATION}},createIcon:function(type){var $icon=$("<div>",{"class":"icon"});type=this.getType(type);var iconClass="fa fa-fw fa-paperclip";switch(type){case this.TYPE_SUCCESS:iconClass="fa fa-fw fa-check-circle";break;case this.TYPE_INFO:iconClass="fa fa-fw fa-info-circle";break;case this.TYPE_WARNING:iconClass="fa fa-fw fa-exclamation-triangle";break;case this.TYPE_ERROR:iconClass="fa fa-fw fa-exclamation-circle";break}$("<i>",{"class":iconClass}).appendTo($icon);return $icon},deleteMessage:function($fm){if(typeof $fm!="object"){return}$fm.slideUp({duration:flashMessages.slideDuration,done:function(){$fm.remove()}})},newMessage:function(message,type){var $fm=$("<div>",{"class":"fm "+this.getType(type),click:function(){var $this=$(this);flashMessages.deleteMessage($this)}}).hide();var $icon=this.createIcon(type);$icon.appendTo($fm);$("<div>",{"class":"message",text:message}).appendTo($fm);$fm.appendTo(this.container);$fm.slideDown(flashMessages.slideDuration);setTimeout(function(){flashMessages.deleteMessage($fm)},5e3)}};function showTab(tabName){$(".tab").hide();$("#tab_"+tabName).fadeIn()}function nicerNumber(num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 ")}function displayStreams(){var html="";var online="";$.each(streams,function(key,stream){if(stream.data.online===false&&settings.onlyOnline==1){return true}if(stream.data.online===true){online="online"}else{online=""}html+='<div class="stream '+online+'" data-url="'+stream.url+'"				<p><span class="stream_name">'+stream.name+'</span></p>				<p><i class="fa fa-users"></i> <span class="stream_viewers">'+nicerNumber(stream.data.viewers)+"</span></p>				</div>"});$("#tab_main").children(".container").html(html);$(".stream").click(function(){chrome.tabs.create({url:$(this).data("url")})});$(".loading").hide()}function refresh(timeout){$(".loading").show();chrome.extension.getBackgroundPage().refresh();timeout=typeof timeout!=="undefined"?timeout:0;setTimeout(displayStreams,timeout)}function addStream_twitch(name,url){var startName=url.indexOf("twitch.tv/");startName+=10;platform_id=url.slice(startName);endName=platform_id.indexOf("?");if(endName>-1)platform_id=platform_id.slice(0,endName);if(platform_id.length>0){chrome.extension.getBackgroundPage().__addStream(name,url,"twitch",platform_id);flashMessages.newMessage("Stream został dodany.",flashMessages.TYPE_SUCCESS)}else{flashMessages.newMessage("Wystąpił błąd.",flashMessages.TYPE_ERROR)}}function addStream_hitbox(name,url){var startName=url.indexOf("hitbox.tv/");startName+=10;platform_id=url.slice(startName);endName=platform_id.indexOf("?");if(endName>-1)platform_id=platform_id.slice(0,endName);if(platform_id.length>0){chrome.extension.getBackgroundPage().__addStream(name,url,"hitbox",platform_id);flashMessages.newMessage("Stream został dodany.",flashMessages.TYPE_SUCCESS)}else{flashMessages.newMessage("Wystąpił błąd.",flashMessages.TYPE_ERROR)}}function addStream(){$(".loading").show();var name=$("#addName").val();$("#addName").val("");var url=$("#addUrl").val();$("#addUrl").val("");if(url.indexOf("twitch.tv")>-1){addStream_twitch(name,url)}else if(url.indexOf("hitbox.tv")>-1){addStream_hitbox(name,url)}else if(url.indexOf("gaminglive.tv")>-1){addStream_gaminglive(name,url)}else{flashMessages.newMessage("Podana strona nie jest obsługiwana.",flashMessages.TYPE_WARNING)}refresh(2e3);showTab("main")}function refreschFreq(){$(".freq").html($("#freq_slider").slider("value"))}function prepareButton(button,setting){if(setting==1){button.prop("checked",true)}else{button.prop("checked",false)}}function saveSettings(){settings.notify=$("#options_notify").prop("checked")===true?1:0;settings.onlyOnline=$("#options_online").prop("checked")===true?1:0;settings.freq=$("#freq_slider").slider("value");chrome.extension.getBackgroundPage().saveSettings();flashMessages.newMessage("Ustawienia zostały zapisane.",flashMessages.TYPE_SUCCESS);refresh();showTab("main")}$(document).ready(function(){streams=chrome.extension.getBackgroundPage().streams;settings=chrome.extension.getBackgroundPage().settings;refresh();$(".sn_version").html(chrome.app.getDetails().version);$("#freq_slider").slider({max:600,value:settings.freq,min:30,step:10,slide:refreschFreq,change:refreschFreq});$(".freq").html(settings.freq);$("#options_notify").prop("checked",settings.notify==1?true:false);$("#options_online").prop("checked",settings.onlyOnline==1?true:false);$(".button_info").click(function(){showTab("info")});$(".button_main").click(function(){showTab("main")});$(".button_add").click(function(){showTab("add");$("#addName").focus()});$(".button_refresh").click(function(){refresh(4e3)});$(".button_submitAdd").click(function(){addStream()});$(".button_saveSettings").click(function(){saveSettings()});$(".button_options").click(function(){showTab("options")})});